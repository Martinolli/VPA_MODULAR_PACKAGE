# VPAA Result Extractor Module

The vpa_result_extractor.py module is designed to process and extract relevant data from the results of Volume Price Analysis (VPA). It provides a structured way to access specific parts of the analysis results, such as price data, volume data, signals, and risk assessments, for individual stock tickers and their respective timeframes. Below is a detailed breakdown of the module, its attributes, methods, and expected behavior.

---

## Module Overview

The module contains:

1. A class `VPAResultExtractor` for extracting and organizing VPA results.
2. A utility function `extract_testing_signals` for extracting specific "Testing" pattern information from the results.

---

## **Class: `VPAResultExtractor`**

### Purpose of `__init__`

The `VPAResultExtractor` class is responsible for:

- Parsing raw VPA results.
- Organizing the data into a structured format for easier access.
- Providing methods to retrieve specific parts of the data, such as price data, volume data, signals, and analyses.

---

### Attributes

1. **`raw_results`**:
   - **Type**: `Dict[str, Any]`
   - **Description**: The raw VPA results passed to the class during initialization. This is typically a dictionary where each key is a stock ticker, and the value contains analysis results for that ticker.

2. **`extracted_data`**:
   - **Type**: `Dict[str, Any]`
   - **Description**: A structured version of the raw results, organized for easier access. This is generated by the `_extract_data` method during initialization.

---

### **Methods**

#### 1. `__init__(self, results: Dict[str, Any])`

- **Purpose**: Initializes the class with raw VPA results and processes them into a structured format.
- **Parameters**:
  - `results`: The raw VPA results to be processed.
- **Behavior**:
  - Stores the raw results in `self.raw_results`.
  - Calls `_extract_data` to process and store the structured data in `self.extracted_data`.

---

#### 2. `_extract_data(self) -> Dict[str, Any]`

- **Purpose**: Processes the raw results into a structured format.
- **Returns**: A dictionary where each ticker's data is organized into:
  - `current_price`: The current price of the ticker.
  - `signal`: The trading signal generated for the ticker.
  - `risk_assessment`: Risk assessment details for the ticker.
  - `timeframes`: A dictionary of data for each timeframe, including:
    - `price_data`: A DataFrame of price data (OHLC).
    - `volume_data`: A DataFrame of volume data.
    - `candle_analysis`: Candle pattern analysis results.
    - `trend_analysis`: Trend analysis results.
    - `pattern_analysis`: Pattern analysis results.
    - `support_resistance`: Support and resistance levels.

---

#### 3. `get_tickers(self) -> List[str]`

- **Purpose**: Retrieves a list of all tickers in the extracted data.
- **Returns**: A list of ticker symbols.

---

#### 4. `get_ticker_data(self, ticker: str) -> Dict[str, Any]`

- **Purpose**: Retrieves all extracted data for a specific ticker.
- **Parameters**:
  - `ticker`: The stock ticker to retrieve data for.
- **Returns**: A dictionary containing the extracted data for the ticker.

---

#### 5. `get_timeframes(self, ticker: str) -> List[str]`

- **Purpose**: Retrieves a list of all timeframes available for a specific ticker.
- **Parameters**:
  - `ticker`: The stock ticker to retrieve timeframes for.
- **Returns**: A list of timeframe strings (e.g., `["1d", "1h", "15m"]`).

---

#### 6. `get_price_data(self, ticker: str, timeframe: str) -> pd.DataFrame`

- **Purpose**: Retrieves the price data (OHLC) for a specific ticker and timeframe.
- **Parameters**:
  - `ticker`: The stock ticker to retrieve data for.
  - `timeframe`: The timeframe to retrieve data for.
- **Returns**: A pandas DataFrame containing the price data.

---

#### 7. `get_volume_data(self, ticker: str, timeframe: str) -> pd.DataFrame`

- **Purpose**: Retrieves the volume data for a specific ticker and timeframe.
- **Parameters**:
  - `ticker`: The stock ticker to retrieve data for.
  - `timeframe`: The timeframe to retrieve data for.
- **Returns**: A pandas DataFrame containing the volume data.

---

#### 8. `get_candle_analysis(self, ticker: str, timeframe: str) -> Dict[str, Any]`

- **Purpose**: Retrieves the candle pattern analysis for a specific ticker and timeframe.
- **Parameters**:
  - `ticker`: The stock ticker to retrieve data for.
  - `timeframe`: The timeframe to retrieve data for.
- **Returns**: A dictionary containing candle pattern analysis results.

---

#### 9. `get_trend_analysis(self, ticker: str, timeframe: str) -> Dict[str, Any]`

- **Purpose**: Retrieves the trend analysis for a specific ticker and timeframe.
- **Parameters**:
  - `ticker`: The stock ticker to retrieve data for.
  - `timeframe`: The timeframe to retrieve data for.
- **Returns**: A dictionary containing trend analysis results.

---

#### 10. `get_pattern_analysis(self, ticker: str, timeframe: str) -> Dict[str, Any]`

- **Purpose**: Retrieves the pattern analysis for a specific ticker and timeframe.
- **Parameters**:
  - `ticker`: The stock ticker to retrieve data for.
  - `timeframe`: The timeframe to retrieve data for.
- **Returns**: A dictionary containing pattern analysis results.

---

#### 11. `get_support_resistance(self, ticker: str, timeframe: str) -> Dict[str, Any]`

- **Purpose**: Retrieves the support and resistance levels for a specific ticker and timeframe.
- **Parameters**:
  - `ticker`: The stock ticker to retrieve data for.
  - `timeframe`: The timeframe to retrieve data for.
- **Returns**: A dictionary containing support and resistance levels.

---

#### 12. `get_signal(self, ticker: str) -> Dict[str, Any]`

- **Purpose**: Retrieves the trading signal for a specific ticker.
- **Parameters**:
  - `ticker`: The stock ticker to retrieve the signal for.
- **Returns**: A dictionary containing the signal details.

---

#### 13. `get_signal_evidence(self, ticker: str) -> Dict[str, List]`

- **Purpose**: Retrieves the evidence supporting the trading signal for a specific ticker.
- **Parameters**:
  - `ticker`: The stock ticker to retrieve signal evidence for.
- **Returns**: A dictionary containing lists of evidence (e.g., candle signals, trend signals).

---

#### 14. `get_risk_assessment(self, ticker: str) -> Dict[str, Any]`

- **Purpose**: Retrieves the risk assessment for a specific ticker.
- **Parameters**:
  - `ticker`: The stock ticker to retrieve risk assessment for.
- **Returns**: A dictionary containing risk assessment details.

---

#### 15. `get_current_price(self, ticker: str) -> float`

- **Purpose**: Retrieves the current price of a specific ticker.
- **Parameters**:
  - `ticker`: The stock ticker to retrieve the current price for.
- **Returns**: The current price as a float.

---

## Function: `extract_testing_signals(results: dict) -> dict`

### Purpose

Extracts "Testing" pattern information for each ticker and timeframe from the raw results.

### Parameters

- `results`: The raw VPA results to extract testing signals from.

### Returns

A dictionary structured as:

```python
{
    "AAPL": {
        "1d": [ { "type": ..., "price": ..., "index": ... }, ... ],
        "1h": [...],
        ...
    },
    ...
}
```

### Behavior

1. Iterates through each ticker and its timeframes.
2. Extracts the "Testing" section from the `pattern_analysis` data.
3. Normalizes keys to lowercase for consistency.
4. Returns a dictionary of testing signals for each ticker and timeframe.

---

## Expected Behavior

- The module is designed to work with the output of a VPA analysis system.
- It provides a clean and structured way to access specific parts of the analysis results.
- The utility function `extract_testing_signals` is useful for extracting specific pattern-related data.

This module is essential for downstream tasks, such as reporting, visualization, or further analysis of VPA results
